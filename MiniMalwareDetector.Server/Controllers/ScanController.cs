using Microsoft.AspNetCore.Mvc;
using MiniMalwareDetector.Core;
using MiniMalwareDetector.Core.Helpers;

namespace MiniMalwareDetector.Server.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class ScanController : ControllerBase
    {
        private readonly IFileService _fileService;
        private readonly IScanService _scanService;

        public ScanController(IFileService fileService, IScanService scanService)
        {
            _fileService = fileService;
            _scanService = scanService;
        }

        [HttpGet("{id}")]
        public string Get(string id)
        {
            return _scanService.GetReport(id);
        }
        
        [HttpPost]
        public async Task<string> Post(string pathDirectoryScan ,List<IFormFile> formFiles)
        {
            var id = Guid.NewGuid().ToString();
            await _fileService.SaveFiles(formFiles, id);
            Task.Run(() => _scanService.Scan(id, pathDirectoryScan));
            return id;
        }
    }
}
