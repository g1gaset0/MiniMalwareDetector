using Microsoft.AspNetCore.Http;

namespace MiniMalwareDetector.Core.Helpers;

public class FileService : IFileService
{

    public async Task<List<FileForm>> SaveFilesInClass(List<IFormFile> formFiles)
    {
        var result = new List<FileForm>();

        foreach (var file in formFiles)
        {
            try
            {
                using (var stream = file.OpenReadStream())
                { 
                    using (var reader = new StreamReader(stream))
                    {
                        var text = await reader.ReadToEndAsync();
                        result.Add(new FileForm(){ Name = file.FileName, Text = text });
                    }
                }
            }
            catch 
            {
                result.Add(new FileForm(){ Name = file.FileName, Text = null, isReadError = true});
            }
        }

        return result;
    }
}