using Microsoft.AspNetCore.Http;

namespace MiniMalwareDetector.Core.Helpers;

/// <summary>
/// Класс реализующий сервис файла
/// </summary>
public class FileService : IFileService
{
    /// <summary>
    /// Сохранить текст и название файла
    /// </summary>
    /// <param name="formFiles">Список файлов из формы для созранения</param>
    /// <returns>Список файлов</returns>
    public async Task<List<FileForm>> SaveFiles(List<IFormFile> formFiles)
    {
        var result = new List<FileForm>();

        foreach (var file in formFiles)
        {
            try
            {
                using (var stream = file.OpenReadStream())
                { 
                    using (var reader = new StreamReader(stream))
                    {
                        var text = await reader.ReadToEndAsync();
                        result.Add(new FileForm(){ Name = file.FileName, Text = text });
                    }
                }
            }
            catch 
            {
                result.Add(new FileForm(){ Name = file.FileName, Text = null, isErrorRead = true});
            }
        }

        return result;
    }
}