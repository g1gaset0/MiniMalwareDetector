using MiniMalwareDetector.Core.FileReports;
using MiniMalwareDetector.Core.FileReports.Repository;

namespace MiniMalwareDetector.Data.FileReports;

/// <summary>
/// Класс реализующий репозиторий для отчета файла
/// </summary>
public class FileReportRepository : IFileReportRepository
{
    /// <summary>
    /// Коллекция отчетов файлов
    /// </summary>
    private static List<FileReportModel> _fileReportStorage = new List<FileReportModel>();
    
    /// <summary>
    /// Создать отчет файла
    /// </summary>
    /// <param name="fileReport">Модель отчета файла бизнес логики</param>
    /// <returns>Идентификатор</returns>
    public Guid Create(FileReport fileReport)
    {
        var entity = new FileReportModel()
        {
            Id = Guid.NewGuid(),
            FileName = fileReport.FileName,
            RuleId = fileReport.RuleId,
            ReportType = fileReport.ReportType,
            ScanReportId = fileReport.ScanReportId
        };
        
        _fileReportStorage.Add(entity);
        return entity.Id;
    }

    /// <summary>
    /// Получить все отчеты файлов по идентификатору отчета сканирования
    /// </summary>
    /// <param name="id">Идентификатор отчета сканирования</param>
    /// <returns>Список отчета файла</returns>
    public List<FileReport> GetFileReportsByScanReportId(Guid id)
    {
       return new List<FileReport>(_fileReportStorage
            .Where(x => x.ScanReportId == id)
            .Select(x => new FileReport()
            {
                Id = x.Id,
                FileName = x.FileName,
                RuleId = x.RuleId,
                ReportType = x.ReportType,
                ScanReportId = x.ScanReportId
            }));
    }
}